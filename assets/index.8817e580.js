import{w as re,S as P,i as H,s as q,e as p,a as V,t as O,b as g,c as z,d,l as X,f as U,g as Y,h as ge,j as C,k as me,m as N,n as he,o as L,p as pe,q as _e,r as be,u as De,v as ye,x as K,y as R,z as ie,A as we,B as ce,C as ve,D as ke,E as x,F as Ie,G as Q,H as Z,I as Fe,J as Xe,K as Je,L as $e,M as Ve,N as ue,O as Ee,P as Pe}from"./vendor.bbe6330e.js";const He=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function o(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerpolicy&&(s.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?s.credentials="include":e.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(e){if(e.ep)return;e.ep=!0;const s=o(e);fetch(e.href,s)}};He();function Be(l){l.slice(0,1)==="#"&&(l=l.slice(1));const n=parseInt(l.substr(0,2),16),o=parseInt(l.substr(2,2),16),t=parseInt(l.substr(4,2),16);return(n*299+o*587+t*114)/1e3>=128?"black":"white"}const ee={red:"#ce0000",green:"#0f480c",yellow:"#dcd138",geel:"#dcd138",orange:"#ff7200",black:"#000000",pink:"#ff00ed",blue:"#0093ff",purple:"#822fe0",lime:"#05ff00",white:"#ffffff"};function te(l,n,o=!1){let t=n.filter((s,a)=>{for(const i of s.climb_groups)if(i.climb_id==l)return s});if(t.length<1)t="";else{if(t[0].color!=null)return t[0].color.toLowerCase();t=t[0].name}if(t=t.toLowerCase(),t.split("/").length>1){const s=t.split("/");if(o)return`--dot-col: linear-gradient(315deg, ${ee[s[0]]} 50%, ${ee[s[1]]} 50%)`;t=s[0]}const e=ee[t]?ee[t]:"#0000ff";return o?`--dot-col: ${e}`:e}const qe={uiaa:{2:"III",3:"IV-",3.44:"IV",3.89:"IV+",4.33:"V-",4.67:"V",4.92:"V+",5.5:"VI",5.21:"VI-",5.78:"VI+",6.06:"VII-",6.33:"VII",6.56:"VII+",6.78:"VIII-",7:"VIII",7.22:"VIII+",7.44:"IX-",7.67:"IX",7.89:"IX+",8.11:"X-",8.33:"X",8.56:"X+",8.78:"XI-",9:"XI",9.22:"XI+",9.44:"XII-"},yds:{2:"5.3",3:"5.4",4:"5.5",4.33:"5.6",4.67:"5.7",5:"5.8",5.33:"5.9",5.67:"5.10a",6:"5.10b",6.5:"5.11a",6.17:"5.10c",6.33:"5.10d",6.67:"5.11b",6.83:"5.11c",7:"5.11d",7.5:"5.12c",7.17:"5.12a",7.33:"5.12b",7.67:"5.12d",7.83:"5.13a",8:"5.13b",8.5:"5.14a",8.17:"5.13c",8.33:"5.13d",8.67:"5.14b",8.83:"5.14c",9:"5.14d",9.5:"5.15c",9.17:"5.15a",9.33:"5.15b"},french:{2:"2",2.5:"2",3:"3a",3.33:"3b",3.67:"3c",4:"4a",4.33:"4b",4.67:"4c",5:"5a",5.17:"5a+",5.33:"5b",5.5:"5b+",5.67:"5c",5.83:"5c+",6:"6a",6.17:"6a+",6.33:"6b",6.5:"6b+",6.67:"6c",6.83:"6c+",7:"7a",7.17:"7a+",7.33:"7b",7.5:"7b+",7.67:"7c",7.83:"7c+",8:"8a",8.17:"8a+",8.33:"8b",8.5:"8b+",8.67:"8c",8.83:"8c+",9:"9a",9.17:"9a+",9.33:"9b",9.5:"9b+"},french_boulder:{2:"2",2.5:"2",2.75:"2+",3:"3a",3.33:"3b",3.67:"3c",4:"4a",4.33:"4b",4.67:"4c",5:"5a",5.17:"5a+",5.33:"5b",5.5:"5b+",5.67:"5c",5.83:"5c+",6:"6a",6.17:"6a+",6.33:"6b",6.5:"6b+",6.67:"6c",6.83:"6c+",7:"7a",7.17:"7a+",7.33:"7b",7.5:"7b+",7.67:"7c",7.83:"7c+",8:"8a",8.17:"8a+",8.33:"8b",8.5:"8b+",8.67:"8c",8.83:"8c+",9:"9a",9.17:"9a+",9.33:"9b",9.5:"9b+"},french_rounded:{2:"2",2.5:"2",2.75:"2+",3:"3",3.33:"3+",3.67:"4-",4:"4",4.33:"4+",4.67:"5-",5:"5",5.5:"5+",6:"6a",6.5:"6b+",6.17:"6a+",6.33:"6b",6.67:"6c",6.83:"6c+",7:"7a",7.5:"7b+",7.17:"7a+",7.33:"7b",7.67:"7c",7.83:"7c+",8:"8a",8.5:"8b+",8.17:"8a+",8.33:"8b",8.67:"8c",8.83:"8c+",9:"9a",9.5:"9b+",9.17:"9a+",9.33:"9b"},ewbank:{2:"7",3:"8",3.33:"9",3.67:"10",4:"11",4.33:"12",4.66:"13",5:"14",5.33:"15",5.67:"16",6:"17",6.5:"20",6.17:"18",6.33:"19",6.67:"21",6.83:"22",7:"23",7.5:"26",7.17:"24",7.33:"25",7.67:"27",7.83:"28",8:"29",8.5:"32",8.17:"30",8.33:"31",8.67:"33",8.83:"34",9:"35",9.5:"38",9.17:"36",9.33:"37"},british:{2:"B0",3:"B1",3.83:"B2",5:"B3",6:"B4",6.28:"B5",6.56:"B6",6.83:"B7",7.11:"B8",7.39:"B9",7.67:"B10",7.87:"B11",8.08:"B12",8.29:"B13",8.5:"B14",8.67:"B15",8.83:"B16",9:"B17"},v_grade:{2:"VB",3:"VB",3.5:"V0-",4:"V0",4.5:"V0+",5:"V1",5.5:"V2",6:"V3",6.33:"V4",6.67:"V5",7:"V6",7.2:"V7",7.4:"V8",7.6:"V9",7.8:"V10",8:"V11",8.17:"V12",8.33:"V13",8.5:"V14",8.67:"V15",8.83:"V16",9:"V17"}};function ne(l,n){return qe[n][Number(l)]}const Se="https://api.toplogger.nu/v1";function Ue(l){return`https://cdn1.toplogger.nu/images/gyms/${l}/floorplan.svg`}function Re(l){const n={filters:{deleted:!1,live:!0}};return`${Se}/gyms/${l}/climbs?json_params=${encodeURIComponent(JSON.stringify(n))}`}function Te(l){const n={filters:{gym_id:l,deleted:!1,live:!0,score_system:"none"},includes:["climb_groups"]};return`${Se}/groups?json_params=${encodeURIComponent(JSON.stringify(n))}`}async function Oe(l,n){const[o,t,e]=await Promise.all([fetch(Re(l)),fetch(Te(l)),fetch(Ue(n))]).then(s=>Promise.all([s[0].json(),s[1].json(),s[2].text()])).then(s=>s).catch(s=>{throw new Error(s)});return[o,t,e]}const We=JSON.parse(localStorage.getItem("gyms")),fe=re(We);fe.subscribe(l=>{typeof l=="object"&&l!=null&&localStorage.setItem("gyms",JSON.stringify(l))});const Ye=re({});Ye.subscribe(l=>{typeof l=="object"&&l!=null&&localStorage.setItem("gym",JSON.stringify(l))});const le=re(void 0);function je(l){const n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=l?new Date(l):new Date,t=n[o.getMonth()],e=String(o.getDate()).padStart(2,"0"),s=o.getFullYear();return`${e} ${t} ${s}`}function ze(l){let n,o,t,e,s,a,i,r,u,f=ne(l[0].grade,"french_boulder")+"",c,_,m,k,J=l[0].nr_of_ascends+"",E,T,M,W,y=l[0].average_opinion+"",v,I,b,D,F,A=je(l[0].date_set)+"",G,B,S,h,$;return{c(){n=p("div"),o=p("div"),t=p("h3"),t.textContent="Route data",e=V(),s=p("button"),s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>',a=V(),i=p("ul"),r=p("li"),u=O("grade: "),c=O(f),_=V(),m=p("li"),k=O("ascends: "),E=O(J),T=V(),M=p("li"),W=O("average opinion: "),v=O(y),I=O("/5.0"),b=V(),D=p("li"),F=O("date set: "),G=O(A),g(t,"class","mr-auto"),g(s,"class","bg-none border-none leading-none"),g(o,"class","flex flex-row items-center mb-4"),g(r,"class","list-none"),g(m,"class","list-none"),g(M,"class","list-none"),g(D,"class","list-none"),g(n,"class","preview fixed bottom-0 left-0 w-screen px-4 py-4 bg-white shadow-lg md:w-max md:right-4 md:left-auto md:bottom-4")},m(w,j){z(w,n,j),d(n,o),d(o,t),d(o,e),d(o,s),d(n,a),d(n,i),d(i,r),d(r,u),d(r,c),d(i,_),d(i,m),d(m,k),d(m,E),d(i,T),d(i,M),d(M,W),d(M,v),d(M,I),d(i,b),d(i,D),d(D,F),d(D,G),S=!0,h||($=X(s,"click",l[1]),h=!0)},p(w,j){l=w,(!S||j&1)&&f!==(f=ne(l[0].grade,"french_boulder")+"")&&U(c,f),(!S||j&1)&&J!==(J=l[0].nr_of_ascends+"")&&U(E,J),(!S||j&1)&&y!==(y=l[0].average_opinion+"")&&U(v,y),(!S||j&1)&&A!==(A=je(l[0].date_set)+"")&&U(G,A)},i(w){S||(Y(()=>{B||(B=ge(n,be,{duration:200,easing:_e},!0)),B.run(1)}),S=!0)},o(w){B||(B=ge(n,be,{duration:200,easing:_e},!1)),B.run(0),S=!1},d(w){w&&C(n),w&&B&&B.end(),h=!1,$()}}}function Ke(l){let n,o,t=l[0]&&ze(l);return{c(){t&&t.c(),n=me()},m(e,s){t&&t.m(e,s),z(e,n,s),o=!0},p(e,[s]){e[0]?t?(t.p(e,s),s&1&&N(t,1)):(t=ze(e),t.c(),N(t,1),t.m(n.parentNode,n)):t&&(he(),L(t,1,1,()=>{t=null}),pe())},i(e){o||(N(t),o=!0)},o(e){L(t),o=!1},d(e){t&&t.d(e),e&&C(n)}}}function xe(l,n,o){let{data:t}=n;function e(s){De.call(this,l,s)}return l.$$set=s=>{"data"in s&&o(0,t=s.data)},[t,e]}class Qe extends P{constructor(n){super();H(this,n,xe,Ke,q,{data:0})}}function Ce(l,n,o){const t=l.slice();return t[5]=n[o],t}function Ne(l){let n,o=l[1],t=[];for(let e=0;e<o.length;e+=1)t[e]=Ae(Ce(l,o,e));return{c(){for(let e=0;e<t.length;e+=1)t[e].c();n=me()},m(e,s){for(let a=0;a<t.length;a+=1)t[a].m(e,s);z(e,n,s)},p(e,s){if(s&2){o=e[1];let a;for(a=0;a<o.length;a+=1){const i=Ce(e,o,a);t[a]?t[a].p(i,s):(t[a]=Ae(i),t[a].c(),t[a].m(n.parentNode,n))}for(;a<t.length;a+=1)t[a].d(1);t.length=o.length}},d(e){ye(t,e),e&&C(n)}}}function Ae(l){let n,o=l[5].name+"",t,e;return{c(){n=p("option"),t=O(o),n.__value=e=l[5],n.value=n.__value},m(s,a){z(s,n,a),d(n,t)},p(s,a){a&2&&o!==(o=s[5].name+"")&&U(t,o),a&2&&e!==(e=s[5])&&(n.__value=e,n.value=n.__value)},d(s){s&&C(n)}}}function Ze(l){let n,o,t,e,s=Object.keys(l[1]).length!=0&&l[1],a,i,r=s&&Ne(l);return{c(){n=p("div"),o=p("label"),o.textContent="Gym",t=V(),e=p("select"),r&&r.c(),g(o,"class","mb-1 block font-bold"),g(o,"for","gym"),g(e,"class","px-2 py-0.5 border-2 rounded w-full"),g(e,"name",""),g(e,"id","gym"),l[0]===void 0&&Y(()=>l[3].call(e)),g(n,"class","p-4")},m(u,f){z(u,n,f),d(n,o),d(n,t),d(n,e),r&&r.m(e,null),K(e,l[0]),a||(i=[X(e,"change",l[3]),X(e,"change",l[4])],a=!0)},p(u,[f]){f&2&&(s=Object.keys(u[1]).length!=0&&u[1]),s?r?r.p(u,f):(r=Ne(u),r.c(),r.m(e,null)):r&&(r.d(1),r=null),f&3&&K(e,u[0])},i:R,o:R,d(u){u&&C(n),r&&r.d(),a=!1,ie(i)}}}function et(l,n,o){let t;we(l,fe,r=>o(1,t=r));let e;const s=ce();ve(async()=>{if(Object.keys(t).length==0||t==null){console.log("fetching gyms");const u=await(await fetch("https://api.toplogger.nu/v1/gyms/")).json();fe.set(u)}});function a(){e=ke(this),o(0,e)}return[e,t,s,a,()=>{s("change",e)}]}class tt extends P{constructor(n){super();H(this,n,et,Ze,q,{})}}function Me(l,n,o){const t=l.slice();return t[5]=n[o],t}function Ge(l){let n,o=l[5].name+"",t,e;return{c(){n=p("option"),t=O(o),n.__value=e=l[5].value,n.value=n.__value},m(s,a){z(s,n,a),d(n,t)},p:R,d(s){s&&C(n)}}}function nt(l){let n,o,t,e,s,a,i=l[1],r=[];for(let u=0;u<i.length;u+=1)r[u]=Ge(Me(l,i,u));return{c(){n=p("div"),o=p("label"),o.textContent="Grade system",t=V(),e=p("select");for(let u=0;u<r.length;u+=1)r[u].c();g(o,"class","mb-1 block font-bold"),g(o,"for","gradeSystem"),g(e,"class","px-2 py-0.5 border-2 rounded w-full"),g(e,"name",""),g(e,"id","gradeSystem"),l[0]===void 0&&Y(()=>l[3].call(e)),g(n,"class","p-4")},m(u,f){z(u,n,f),d(n,o),d(n,t),d(n,e);for(let c=0;c<r.length;c+=1)r[c].m(e,null);K(e,l[0]),s||(a=[X(e,"change",l[3]),X(e,"change",l[4])],s=!0)},p(u,[f]){if(f&2){i=u[1];let c;for(c=0;c<i.length;c+=1){const _=Me(u,i,c);r[c]?r[c].p(_,f):(r[c]=Ge(_),r[c].c(),r[c].m(e,null))}for(;c<r.length;c+=1)r[c].d(1);r.length=i.length}f&3&&K(e,u[0])},i:R,o:R,d(u){u&&C(n),ye(r,u),s=!1,ie(a)}}}function lt(l,n,o){let t;const e=[{name:"Same as gym",value:void 0},{name:"UIAA",value:"uiaa"},{name:"YDS",value:"yds"},{name:"French",value:"french"},{name:"French boulder",value:"french_boulder"},{name:"French rounded",value:"french_rounded"},{name:"Ewbank",value:"ewbank"},{name:"British",value:"british"},{name:"V Grade",value:"v_grade"}],s=ce();function a(){t=ke(this),o(0,t),o(1,e)}return[t,e,s,a,()=>{le.set(t),s("change",t)}]}class st extends P{constructor(n){super();H(this,n,lt,nt,q,{})}}function ot(l){let n,o,t,e,s,a,i,r,u,f,c,_;return i=new tt({}),i.$on("change",l[4]),u=new st({}),u.$on("change",at),{c(){n=p("header"),o=p("label"),o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>',t=V(),e=p("input"),s=V(),a=p("div"),x(i.$$.fragment),r=V(),x(u.$$.fragment),g(o,"for","menuToggle"),g(o,"class","z-20"),g(e,"type","checkbox"),g(e,"id","menuToggle"),g(e,"class","w-0 h-0 hidden"),g(a,"class","menu fixed top-0 left-0 h-screen w-80 pt-12 bg-white shadow-lg svelte-3241ld"),Ie(a,"open",l[1]),g(n,"class","fixed top-0 left-0 z-30 flex items-center px-4 py-2 bg-white shadow-lg svelte-3241ld")},m(m,k){z(m,n,k),d(n,o),d(n,t),d(n,e),e.checked=l[1],d(n,s),d(n,a),Q(i,a,null),d(a,r),Q(u,a,null),f=!0,c||(_=X(e,"change",l[3]),c=!0)},p(m,[k]){k&2&&(e.checked=m[1]),k&2&&Ie(a,"open",m[1])},i(m){f||(N(i.$$.fragment,m),N(u.$$.fragment,m),f=!0)},o(m){L(i.$$.fragment,m),L(u.$$.fragment,m),f=!1},d(m){m&&C(n),Z(i),Z(u),c=!1,_()}}}const at=l=>{};function rt(l,n,o){const t=ce();let e=!1,{selected:s}=n;function a(){e=this.checked,o(1,e)}const i=r=>{o(0,s=r.detail),t("changeGym",r.detail)};return l.$$set=r=>{"selected"in r&&o(0,s=r.selected)},[s,e,t,a,i]}class it extends P{constructor(n){super();H(this,n,rt,ot,q,{selected:0})}}const{window:de}=Je;function Le(l){let n,o;return n=new Qe({props:{data:l[6]}}),n.$on("click",l[12]),{c(){x(n.$$.fragment)},m(t,e){Q(n,t,e),o=!0},p(t,e){const s={};e&64&&(s.data=t[6]),n.$set(s)},i(t){o||(N(n.$$.fragment,t),o=!0)},o(t){L(n.$$.fragment,t),o=!1},d(t){Z(n,t)}}}function ct(l){let n,o,t,e,s,a,i,r,u;Y(l[10]),n=new it({}),n.$on("changeGym",l[11]);let f=l[2]&&Le(l);return{c(){x(n.$$.fragment),o=V(),t=p("main"),e=p("div"),a=V(),f&&f.c(),g(e,"class","svgContainer h-screen svelte-1uvat6c")},m(c,_){Q(n,c,_),z(c,o,_),z(c,t,_),d(t,e),e.innerHTML=l[4],d(t,a),f&&f.m(t,null),i=!0,r||(u=[X(de,"resize",l[10]),Fe(s=l[9].call(null,e,l[4]))],r=!0)},p(c,[_]){(!i||_&16)&&(e.innerHTML=c[4]),s&&Xe(s.update)&&_&16&&s.update.call(null,c[4]),c[2]?f?(f.p(c,_),_&4&&N(f,1)):(f=Le(c),f.c(),N(f,1),f.m(t,null)):f&&(he(),L(f,1,1,()=>{f=null}),pe())},i(c){i||(N(n.$$.fragment,c),N(f),i=!0)},o(c){L(n.$$.fragment,c),L(f),i=!1},d(c){Z(n,c),c&&C(o),c&&C(t),f&&f.d(),r=!1,ie(u)}}}function ut(l,n,o){let t;we(l,le,y=>o(8,t=y));let e=!1,s,a=[],i="",r,u,f=1,c,_={},m=window.innerWidth,k=window.innerHeight;function J(y,v){return{update(){E(a,r)},destroy(){}}}le.subscribe(y=>{s&&s.selectAll("div").html(v=>ne(v.grade,y||"french_boulder")).attr("style",v=>te(v.id,r,!0)).style("color",v=>Be(te(v.id,r,!1)))});function E(y,v){const I=$e("svg.flex").attr("width",m).attr("height",k);Ve("g#zoom_layer").each(function(){let h=this;$e(h.parentNode).insert("g").attr("class","zoom").append(()=>h)});const b=I.select("#zoom_layer").node().getBBox();c=I.select("#zoom_layer").attr("transform",`translate(${-b.x}, ${-b.y})`).append("g").attr("class","routes"),s=c.selectAll("foreignObject").data(y).enter().append("foreignObject").on("click",(h,$)=>{h.stopPropagation(),o(6,u=$),o(2,e=!0);const w=b.width/m*.75,j=b.width*$.position_x-b.x,se=b.height*$.position_y-b.y,oe=m/2-20,ae=k/2-20;I.transition().duration(500).call(A.transform,ue.translate(-j*w+oe,-se*w+ae).scale(w))}).attr("x",h=>b.width*h.position_x).attr("y",h=>b.height*h.position_y).attr("width",40).attr("height",40),s.append("xhtml:div").html(h=>ne(h.grade,t||"french_boulder")).attr("style",h=>te(h.id,v,!0)).style("color",h=>Be(te(h.id,v,!1)));const D=I.select(".zoom"),F=150,A=Ee().translateExtent([[-F,-F],[b.width+F,b.height+F]]).scaleExtent([.1,2.5]).on("zoom",(h,$)=>{D.attr("transform",h.transform),f=Math.round(1/h.transform.k*100)/100}),G=k/b.height*.9,B=m/2-b.width/2*G,S=k/2-b.height/2*G;I.call(A).call(A.transform,ue.translate(B,S).scale(G)),I.select(".zoom").attr("transform",`translate(${B}, ${S}) scale(${G})`),Ve("g.map-region").on("click",function(h){h.stopPropagation();const $=I.select(`#${this.id}`).node().getBBox(),w=k/$.height*.8,j=-($.x-b.x)*w,se=-($.y-b.y)*w,oe=k/2-$.height/2*w,ae=m/2-$.width/2*w;I.transition().duration(500).call(A.transform,ue.translate(j+ae,se+oe).scale(w))})}ve(async()=>{o(3,[a,r,i]=await Oe(8,"bruut_boulder_breda"),a,o(5,r),o(4,i));let y;function v(){y=requestAnimationFrame(v),c&&c.attr("style",`--dot-scale: ${f}`)}return v(),()=>cancelAnimationFrame(y)});function T(){o(1,k=de.innerHeight),o(0,m=de.innerWidth)}const M=async y=>{o(7,_=y.detail);let I=await(await fetch(`https://api.toplogger.nu/v1/gyms/${y.detail.slug}`)).json();Pe(le,t=I.grading_system_boulders||I.grading_system_routes,t),o(3,[a,r,i]=await Oe(_.id,_.id_name),a,o(5,r),o(4,i))},W=()=>{o(2,e=!1)};return l.$$.update=()=>{l.$$.dirty&1,l.$$.dirty&2},[m,k,e,a,i,r,u,_,t,J,T,M,W]}class ft extends P{constructor(n){super();H(this,n,ut,ct,q,{})}}new ft({target:document.body,props:{}});
