import{w as t,S as e,i as n,s as o,e as r,a as s,t as a,b as i,c as l,d as c,f as d,n as f,g as u,h as p,j as g,m,l as h,k as y,o as $,p as w,q as v,r as b,u as x,v as _,x as N,y as z,z as S,A as j,B as k}from"./vendor.65040f49.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const n of t)if("childList"===n.type)for(const t of n.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerpolicy&&(e.referrerPolicy=t.referrerpolicy),"use-credentials"===t.crossorigin?e.credentials="include":"anonymous"===t.crossorigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();t(JSON.parse(localStorage.getItem("gyms"))).subscribe((t=>{"object"==typeof t&&null!=t&&localStorage.setItem("gyms",JSON.stringify(t))}));function L(t){let e,n,o,p,g,m=JSON.stringify(t[0],void 0,2)+"";return{c(){e=r("div"),n=r("h3"),n.textContent="Route data",o=s(),p=r("pre"),g=a(m),i(e,"class","preview svelte-1l1didp")},m(t,r){l(t,e,r),c(e,n),c(e,o),c(e,p),c(p,g)},p(t,[e]){1&e&&m!==(m=JSON.stringify(t[0],void 0,2)+"")&&d(g,m)},i:f,o:f,d(t){t&&u(e)}}}function O(t,e,n){let{data:o}=e;return t.$$set=t=>{"data"in t&&n(0,o=t.data)},[o]}class C extends e{constructor(t){super(),n(this,t,O,L,o,{data:0})}}const{window:J}=N;function B(t){let e,n,o,a,d,f,_,N;return p(t[4]),d=new C({props:{data:t[3]}}),{c(){e=r("main"),n=r("div"),a=s(),g(d.$$.fragment),i(n,"class","svgContainer svelte-1ajd62j")},m(r,s){l(r,e,s),c(e,n),n.innerHTML=t[2],c(e,a),m(d,e,null),f=!0,_||(N=[h(J,"resize",t[4]),y(o=P.call(null,n,t[2]))],_=!0)},p(t,[e]){(!f||4&e)&&(n.innerHTML=t[2]),o&&$(o.update)&&4&e&&o.update.call(null,t[2]);const r={};8&e&&(r.data=t[3]),d.$set(r)},i(t){f||(w(d.$$.fragment,t),f=!0)},o(t){v(d.$$.fragment,t),f=!1},d(t){t&&u(e),b(d),_=!1,x(N)}}}const I="https://api.toplogger.nu/v1";function P(t,e){return{update(){console.log("updated svg",e,t)},destroy(){console.log("destroyed",t)}}}function A(t){const e={filters:{gym_id:t,deleted:!1,live:!0,score_system:"none"},includes:["climb_groups"]};return`${I}/groups?json_params=${encodeURIComponent(JSON.stringify(e))}`}function H(t,e,n){let o,r=[],s="",a=window.innerWidth,i=window.innerHeight;function l(){console.log("map setup"),z("svg.flex").attr("width",a).attr("height",i)}function c(t,e){const s=a,l=i,c=z("svg.flex").attr("width",a).attr("height",i);S("g#zoom_layer").each((function(){let t=this;z(t.parentNode).insert("g").attr("class","zoom").append((()=>t))}));const d=c.select("#zoom_layer").node().getBBox();z("#zoom_layer").attr("transform",`translate(${-d.x}, ${-d.y}) scale(1)`);const f=c.select("#zoom_layer").append("g").attr("class","routes");r=f.selectAll("g").data(t).enter().append("g").attr("transform",(t=>{return`translate(${e=t.position_x,d.width*e}, ${function(t){return d.height*t}(t.position_y)})`;var e})).attr("class","route").on("click",(function(t,e){t.stopPropagation(),n(3,o=e);const r=d.width/s*.75,a=d.width*e.position_x-d.x,i=d.height*e.position_y-d.y,f=s/2-2.5,p=l/2-2.5;c.transition().duration(500).call(u.transform,j.translate(-a*r+f,-i*r+p).scale(r))})).append("g").attr("class","scale"),r.append("circle").attr("r",20).style("fill",(t=>`#${function(t,e){let n=e.filter(((e,n)=>{for(const o of e.climb_groups)if(o.climb_id==t)return e}));n=n.length<1?"aaa":n[0].name;const o={red:"ce0000",green:"0f480c",yellow:"dcd138",orange:"ff7200",black:"000000",pink:"ff00ed",blue:"0093ff",purple:"822fe0",lime:"05ff00",white:"ffffff"};return o[n.toLowerCase()]?o[n.toLowerCase()]:"0000ff"}(t.id,e)}`)),r.append("text").attr("dy",5).text((t=>function(t){const e=~~Number(t);let n=t.replace(/^./g,"0");t<3&&(n=t);const o={2.75:"+","0.0":"a",.17:"a+",.33:"b",.5:"b+",.67:"c",.83:"c+"};return`${e}${o[n]?o[n]:""}`}(t.grade))).attr("text-anchor","middle");const u=k().scaleExtent([.1,2.5]).on("zoom",((t,e)=>{c.select(".zoom").attr("transform",t.transform),f.selectAll("g.scale").attr("transform",(()=>`scale(${1/t.transform.k})`))})),p=l/d.height*.9,g=s/2-d.width/2*p,m=l/2-d.height/2*p;c.call(u).call(u.transform,j.translate(g,m).scale(p)),c.select(".zoom").attr("transform",(()=>`translate(${g}, ${m}) scale(${p})`)),S("g.map-region").on("click",(function(t){t.stopPropagation(),console.log("clicked map region",this.id);const e=c.select(`#${this.id}`).node().getBBox(),n=l/e.height*.8,o=-(e.x-d.x)*n,r=-(e.y-d.y)*n,a=l/2-e.height/2*n,i=s/2-e.width/2*n;c.transition().duration(500).call(u.transform,j.translate(o+i,r+a).scale(n))}))}return _((async()=>{let t,e;var o,r;n(2,[t,e,s]=await Promise.all([fetch((r=8,`${I}/gyms/${r}/climbs?json_params=${encodeURIComponent(JSON.stringify({filters:{deleted:!1,live:!0}}))}`)),fetch(A(8)),fetch((o="bruut_boulder_breda",`https://cdn1.toplogger.nu/images/gyms/${o}/floorplan.svg`))]).then((t=>Promise.all([t[0].json(),t[1].json(),t[2].text()]))).then((t=>(n(2,s=t[2]),t))).catch((t=>{throw new Error(t)})),s),c(t,e)})),t.$$.update=()=>{1&t.$$.dirty&&l(),2&t.$$.dirty&&l()},[a,i,s,o,function(){n(1,i=J.innerHeight),n(0,a=J.innerWidth)}]}new class extends e{constructor(t){super(),n(this,t,H,B,o,{})}}({target:document.body,props:{}});
